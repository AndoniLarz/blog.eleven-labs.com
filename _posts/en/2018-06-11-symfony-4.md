--- 
layout: post  
title: "Symfony 4"   
lang: en  
permalink: /en/symfony-4/  
excerpt: "We gonna to see Symfony 4 news and change."  
authors:  
    - amoutte  
categories:
    - php
    - symfony 4
tags:
    - php
    - symfony 4
cover: /assets/2018-06-11-symfony-4/cover.jpg  
--- 

Symfony 4 released more than 6 month ago (30 novembre 2017). The main change in Symfony 4 is the way of creating application and how append feature during project lifetime.

⚠️ Keep in mind that Symfony 4 now require **PHP 7.1.3** minimum !

## Flex

[Flex](https://github.com/symfony/flex) is the new tools used by Symfony to manage project.
It is a composer plugin to help developer to create Symfony application.
 
> ℹ️ It replace [Symfony standard edition](https://github.com/symfony/symfony-standard) and the [Symfony installer](https://github.com/symfony/symfony-installer).

Flex use `recipes` (ɹɛ.sɪ.piz).
A `recipe` is a `manifest.json` file. It contain some actions to do during the installation process.
It allow you to create folder, copy config files, add some environment variable (.env) etc... 
Full action list in the [documentation](https://github.com/symfony/recipes/blob/master/README.rst).

`recipes` are store in two repository :
 * [main recipes repository](https://github.com/symfony/recipes) high quality `recipes`. Flex default repository.
 * [contrib recipes repository](https://github.com/symfony/recipes-contrib) community `recipes`, Flex always ask your permission before install it.

> ℹ️ You can go to the new website [symfony.sh](https://symfony.sh/) to find `recipes`.

### Usage

Ok, we gonna to show how create Symfony 4 project with Flex.

```
$ composer create-project symfony/website-skeleton my-project

```

> ℹ️ Use `symfony/skeleton` `recipe` to create lightweight project.
> It only require :
> * symfony/console
> * symfony/flex
> * symfony/framework-bundle
> * symfony/lts
> * symfony/yaml

Flex will create following folder tree.

```
assets        static ressources (image, js, css, ...)
bin           runnable (console, phpunit, ...)
config        application config files
public        public files (front controller index.php)
src           application source code
templates     templating files (twig, html, ...)
tests         tests files
translations  translation files
var           some temporary files (cache, logs, upload, ...)
vendor        third party library
```

In order to have your first page :

* create template file `my-project/templates/index.html.twig`

{% raw %}
```twig
{% extends 'base.html.twig' %}
{% block body %}Welcome{% endblock %}
``` 
{% endraw %}

* create controller file `my-project/src/Controller/DefaultController.php` 

{% raw %}
```php
<?php

namespace App\Controller;

use Symfony\Bundle\FrameworkBundle\Controller\Controller;
use Symfony\Component\Routing\Annotation\Route;

class DefaultController extends Controller
{
    /**
     * @Route("/", name="index")
     */
    public function index()
    {
        return $this->render('index.html.twig');
    }
}
```
{% endraw %}

> Caution, controller name are not suffixe by `Action` anymore.

## Where are bundle ? 

You are not constraint to create bundle in src (AppBundle).
You must now register your bundle in `config/bundles.php` file.

{% raw %}
```php
<?php

return [
    // ...
    Symfony\Bundle\FrameworkBundle\FrameworkBundle::class => ['all' => true],
    Symfony\Bundle\WebServerBundle\WebServerBundle::class => ['dev' => true],
    // ...
];
``` 
{% endraw %}

## Conclusion

We haved several choices before Symfony 4 :

* Use symfony distribution (standard, cmf-standard, rest ...) or [microkernel](https://github.com/symfony/symfony/blob/master/src/Symfony/Bundle/FrameworkBundle/Kernel/MicroKernelTrait.php).
> Ready to use (ORM, swiftmailer, twig, ...). 
> It can bring useless feature (forced to disable/delete).  
    
* Use Symfony component as third party or use [Silex](https://github.com/silexphp/Silex)
> Lightweight solution.
> Need strong knowledge to initialise all the component with configuration and cache.

Symfony 4 reworked to ease the initialisation process and not bring unwanted component.
It help to manage feature along project lifetime.

There is top 3 [Symfony 4.0 changes](https://github.com/symfony/symfony/blob/master/UPGRADE-4.0.md) :
* News folder structure.
* `LockHandler` replace by `Symfony\Component\Lock\Store\FlockStore`/`Symfony\Component\Lock\Store\FlockStore\SemaphoreStore`
* ClassLoader replace by composer autoload.

PS : I recommend you to re visit [Symfony component list](https://github.com/symfony/symfony/tree/master/src/Symfony/Component), 
because now you need to use `recipe` or compose your need with third party library.

